# Frequently Asked Questions

## To which problems was ***ConfID*** designed for?

Genetic algorithms and knowledge-based approaches have been employed to study molecular flexibility. However, these methods are usually based on crystallographic information, and their calculations are made in vacuum or with implicit solvent and do not take into account the influence of explicit solvent molecules on conformational preferences. 

By using structural information gathered from MD simulations (and assuming accurate parameters are used), ***ConfID*** can identify all conformational populations of drug-like molecules sampled in the presence of solvent and quantify their relative abundance, while harnessing the benefits of MD and calculating time-dependent properties of each conformational population.

![alt text](https://github.com/sbcblab/confid/blob/master/images/confid1.png "ConfID")

## How does ***ConfID*** work?

If we consider the dihedral angles of a molecule throughout an MD simulation, a conformational population is the set of conformations sharing similar values for their respective dihedral angles. ***ConfID*** finds these conformational populations by following this procedure:

1 - The value of each dihedral angle is measured for each simulation time step, as well as the distribution of the angle (how much of the total simulated time was spent in each angle value). These distributions are smoothed using the Hann function with a sliding window, obtaining a curve with well-behaved gradient. 

2 - From this distribution, “peaks” and “valleys” are identified. A peak is an angle with maximum local value (the distribution of that angle is larger than the distribution of its immediate neighbors). A valley is an angle with minimum local value or angles with distribution below a given threshold that indicates a distribution value so low that the angle should be considered spurious. 

Now that we have the peaks and valleys, ***ConfID*** can identify dihedral populations of each torsional bond as a peak angle between two valleys, which corresponds to a region of high distribution. The conformational populations of a molecule are then characterized by the combination of all dihedral angles (identified by the peak values) occurring at the same time step, that is, by a tuple of n peaks, with n being the number of torsional bonds. Thus, all conformations represented by the same tuple of dihedral values belong to the same conformational population, while the number of conformations that receive the same tuple determines the relative abundance of the conformational population and the number of different tuples is the number of different populations throughout a simulation.

![alt text](https://github.com/sbcblab/confid/blob/master/images/confid2.png "ConfID")

## How do I install ***ConfID***?

 ***ConfID*** is available as a source code, snapcraft and macOS exec. You can find the complete list of instructions to install and run ***ConfID*** by reading [INSTALL.md](INSTALL.md).

## Which files does ***ConfID*** require?

 ***ConfID*** requires only ```input.inp``` file to run and the files containing the evolution of dihedral values throughout MD trajectory. Optionally, a configuration file ```config``` can be provided to use non-default parameters.

## What is the input.inp file?

An input file (```input.inp```) ([see an example!](input.inp)) can be used to set which input files will be analyzed by ***ConfID*** :

```
# Files of Dihedral values sampled throughout MD trajectory
DIH1.dat
DIH2.dat
DIH3.dat
DIH4.dat
```

## Should dihedral files have a specific format?

To properly characterize conformers of a drug-like molecule, ***ConfID*** requires only one file for each relevant torsion, containing their dihedral values sampled during MD simulations. Such files are easily generated by most common MD suites and our software was designed to be universally compatible. For this, ***ConfID*** accepts two input formats: files containing both frame and respective dihedral values (2-columns) or 1-column file containing only dihedral values.

For example: GROMACS tool ```gmx angle``` outputs the evolution of dihedral values as a function of time in a 2-column file type by default, as shown below ([see an example!](Tutorials/ANA/DIH1.aver.xvg)):

```
# Created by:
#:-) GROMACS - gmx angle (-:
#
# FRAME DIH VALUE
0.00000 7.620
10.00000 -42.346
20.00000 5.688
30.00000 -15.020
40.00000 -14.126
50.00000 -3.476
60.00000 -5.852
70.00000 -3.976
80.00000 -22.790
90.00000 -10.469
100.00000 -1.266
...
```
Moreover VMD/NAMD suites can output dihedral values in a single column file through a TCL command-line, such as the one below:
```
# Created by:
# TCL/VMD script
# 
# DIH VALUE
    7.620
  -42.346
    5.688
  -15.020
  -14.126
   -3.476
   -5.852
   -3.976
  -22.790
  -10.469
   -1.266
    ...
```
**IMPORTANT**: if 1-column file format is chosen, the total simulation time **must** be provided in the ```config``` file.

## What is the config file?

A configuration file (```config```) ([see an example!](config)) can be used to set ***ConfID*** parameters:
```
RESULTS_FOLDER (string) defaults to Output/Populations/
DIH_POP_FOLDER (string) defaults to Output/Dihedral_Regions/
TIME_STATS_FOLDER (string) defaults to Output/Time_Dependent_Stats/
NETWORK_FOLDER (string) defaults to Output/Networks/
SIM_TIME (None or float) [None / > 0.0] defaults to None
SHOW_Z (string) [False / True] defaults to False
NETWORK_CUTOFF (float) [>= 0.0] defaults to 0.01
PLOT_NETWORK (string) [False / True] defaults to False
CONVERGENCE_CUTOFF (float) [>= 0.0] defaults to 0.01
FACTOR_PEAK (float) [>= 1.0, < FACTOR_VALLEY] defaults to 50.0
FACTOR_VALLEY (float) [>= 1.0, > FACTOR_PEAK] defaults to 60.0
TIME_DEPENDENT_STATS (string) [False / True] defaults to True
DATA_1 (list of strings)
[sum / max / min / aver / std / median / count] defaults to sum
DATA_2 (list of strings)
[sum / max / min / aver / std / median / count] defaults to aver
```
A brief explanation of each parameter:
```
RESULTS_FOLDER: specifies the directory in which output files should be saved.
DIH_POP_FOLDER: specifies the directory in which output .xvg files should be saved.
NETWORK_FOLDER: specifies the directory in which output network files should be saved.
TIME_STATS_FOLDER: specifies the directory in which output transition files should be saved.
SIM_TIME: specifies the total simulation time. SIM_TIME is mandatory if you are working with dihedral files with only one column (dihedral angle). Otherwise, it is optional but must be equal to the actual total simulation time. Must be a value larger than zero. It is important to notice that the timescale chosen here is the same for the time-dependent properties. We suggest the use of a picosecond timescale.
SHOW_Z: a flag that determines if spurious regions (Z) should be represented in the results. They will be used in the internal calculations nevertheless. If this is True, please consider setting PLOT_NETWORK to False, as plotting the chart may become too slow.
NETWORK_CUTOFF: the smallest transition frequency required for an edge to appear in the networks. If equal to 0.0, all edges are considered. If this cutoff is too small, please consider setting PLOT_NETWORK to False, as plotting the chart may become too slow.
PLOT_NETWORK: if True, networks figures for the transitions will be created using the graphviz library. Network text files will be created if it is either True or False.
CONVERGENCE_CUTOFF: the smallest population frequency at the end of the simulation required for the convergence file for that population to be generated. If equal to 0.0, all populations will be represented, but for a large number of dihedral angles, this can take a while.
FACTOR_PEAK: a factor that sets the constriction for peaks selection. Larger values lessen the constriction.
FACTOR_VALLEY: a factor that sets the constriction for valleys selection. Lower values lessen the constriction.
TIME_DEPENDENT_STATS: flag that determines if the statistics of the time stayed at each population should be computed.
DATA_1: list of functions that should be used as the x-axis of the charts of the statistics of the time stayed at each population and how the report should be ordered.
DATA_2: list of functions that should be used as the y-axis of the charts of the statistics of the time stayed at each population and how the report should be ordered.
```
The functions available for time-dependent properties calculation are:
```
- sum: total time in a population
- max: maximum time spent in a population without leaving
- min: minimum time spent in a population without leaving
- aver: average time spent in a population without leaving
- std: standard deviation of the average time
- median: median time spent in a population without leaving
- count: the amount of times of a transition event entering this population
```
## ***ConfID*** runs persist to crash. What can be possibly wrong?

Assuming that all Python prerequisites were [correctly installed](INSTALL.md) and you know what you are doing (have you tried our [Tutorials section?](TUTORIAL.md)), the most common errors and warnings are:

- _"Segmentation Fault"_

In general, that means ***ConfID*** is using too much memory, most probably due to the number of frames saved in your inputs. You might want to try to close some applications or to reduce the frequency of frames in your inputs.

- _"ERROR: wrong number of parameters given to ConfID: To run ConfID, please provide the path to the input.inp and optionally the path to the config file."_
This error means that the wrong number of inputs was given to ***ConfID***. ***ConfID*** accepts the following commands:
```
$ confid
$ confid -h
$ confid input.inp
$ confid input.inp config
```

- _"PermissionError: IMPORTANT! Are you trying to read or write files in a removable media (pendrives, external HDs, etc)? Then you must give ConfID access to removable media after installing it by running the following command in your terminal: snap connect confid:removable-media"_

This error happens if you install ***ConfID*** using the snapcraft, try to read or write a file from a removable media, but did not give ***ConfID*** access to removable media. To solve it type on your terminal:
```
$ snap connect confid:removable-media
```

- _"ERROR: wrong number of columns in the dihedral file! ConfID only reads files with one (dihedral value) or two columns (time and dihedral value)."_

This means that one or more of your files with dihedral values have more than two columns in at least one line. Please check your files and remember that ***ConfID*** accepts dihedral files with one (dihedral value) or two columns (time and dihedral value).

- _"ERROR: extra value in the dihedral file! ConfID only reads files with one (dihedral value) or two columns (time and dihedral value)."_

This means that you are using dihedral files with only one column (dihedral value) but at least one line has more than one value.

- _"ERROR: missing value in the dihedral file! ConfID only reads files with one (dihedral value) or two columns (time and dihedral value)."_

This means that you are using dihedral files with two columns (time and dihedral value), but at least one line has less than two values.

- _"ERROR: conflicting number of timesteps in the dihedral file."_

This means that at least one dihedral file from your ```input.inp``` has a different number of timesteps. Please ensure that all your input files have the exact same number of simulation timesteps.

- _"ERROR: Wrong number of columns in file: Config file must have only two columns separated by space."_

This means that your ```config``` file has a line with less than or more than two columns. The optional ```config``` file requires exactly two columns separated by spaces.

- _"ERROR: graphviz package needs to be installed if PLOT\_NETWORK is True, but it couldn't be imported."_

This will happen if you try to plot networks within ***ConfID*** but does not have the Graphviz package installed in your system. You can either [install Graphviz manually]( https://graphviz.readthedocs.io/en/stable/manual.html) or set PLOT\_NETWORK to False and use the .gml files generated in a network visualization software such as [Cytoscape](https://cytoscape.org/).

- _"ERROR: matplotlib.pyplot package needs to be installed if TIME\_DEPENDENT\_STATS is True, but it couldn't be imported."_

This will happen if you don't have the matplotlib package installed in your system. You can solve this by installing [matplotlib](https://matplotlib.org/3.1.0/users/installing.html) or setting TIME\_DEPENDENT\_STATS to False.

- _"ERROR: SIM\_TIME must be 'None' or a value larger than 0.0!"_

To solve this problem, set the SIM\_TIME value in your ```config``` file to "None" or to be larger than 0.0.

- _"ERROR: FACTOR\_PEAK must be larger or equal to 1.0."_

To solve this problem, set the FACTOR\_PEAK value in your ```config``` file to be larger or equal to 1.0.

- _"ERROR: FACTOR\_VALLEY must be larger or equal to 1.0."_ 

To solve this problem, set the FACTOR\_VALLEY value in your ```config``` file to be larger or equal to 1.0.

- _"ERROR: FACTOR\_VALLEY must be larger than FACTOR\_PEAK"_

To solve this problem, set the FACTOR\_VALLEY value in your ```config``` file to be larger than FACTOR\_PEAK.

- _"ERROR: No peaks were found! Try using a larger threshold value for FACTOR\_PEAK to solve the problem."_

This error will happen if you use a FACTOR\_PEAK so small that no peaks could be found.

- _"ERROR: No valleys were found! Try using a larger threshold value for FACTOR\_VALLEY to solve the problem."_

This error will happen if you use a FACTOR\_VALLEY so large that no peaks could be found.

- _"ERROR: total simulation time in the dihedral file is different from simulation time in the config file!"_
There is a value other than "None" for SIM\_TIME in the ```config``` file, and the dihedral files have two columns, one of them being the time steps. The values in these files are different, so one of them must be wrong.

- _"ERROR: total simulation time was not declared in the config file, but the dihedral file has no time column!"_

The SIM\_TIME was equal to "None" or was not specified in the ```config``` file, but the dihedral files do not have a time column. Please set SIM\_TIME to the total simulation time.

- _"ERROR: Unidentified function:"_

This error will happen when an unidentified function is passed as an argument to DATA\_1 or DATA\_2 in the ```config``` file. The possible values are sum, max, min, aver, std, median, and count.

- _"ValueError: Input vector needs to be bigger than window size."_

This error will happen only if the file containing the dihedral distributions (```*.dist.xvg```) has less than 21 angles listed.

- _"WARNING: Unidentified parameter ignored"_

This means that some parameters in your ```config``` file could not be recognized and were ignored. Please review the spelling of the parameters and check if they match the documentation.

- _"WARNING: declared simulation time in the config file and in the dihedral file at the same time."_

This is a reminder that there is a value other than "None" for SIM\_TIME in the ```config``` file, and the dihedral files have two columns, one of them being the time steps. If the values in these files do not match up, an error will arise.

- _"WARNING: plotting the graph figures may become too slow if the Z populations are to be shown, please consider setting either SHOW\_Z or PLOT\_NETWORK to False or to use a large NETWORK\_CUTOFF."_

This warning appears if both SHOW\_Z and PLOT\_NETWORK are True.

- _"WARNING: the frequency of the conformational populations in the stay stats may vary slightly from the previous results if Z populations are disregarded."_

- _"WARNING: Did not plot network with more than 200 nodes."_

This warning appears to avoid memory and processing time issues by plotting a huge network. It occurs when PLOT\_NETWORK is True, and the network has more than 200 nodes. You can use the .gml files generated in a network visualization software such as [Cytoscape](https://cytoscape.org/).

## I have found a bug. I demand to speak to the manager!

We apologize for any bugs you may be witnessing. We kindly ask you to send your inputs and a brief description of what you are trying to achieve (organized screenshots may help) to marcelo.poleto@ufv.br or bigrisci@inf.ufrgs.br and our team will deal with it as soon as possible! 

## Which works use ***ConfID***?

There are some papers already using ***ConfID***! Take a look:

- Pablo R. Arantes, Conrado Pedebos, Marcelo D. Polêto, Laércio Pol-Fachin, and Hugo Verli. _The Lazy Life of Lipid-Linked Oligosaccharides in All Life Domains_, Journal of Chemical Information and Modeling **2019** XXXX, XXX, XXX-XXX, DOI: [10.1021/acs.jcim.9b00904](https://doi.org/10.1021/acs.jcim.9b00904)

- Pablo R. Arantes, Marcelo D. Polêto, Elisa B. O. John, Conrado Pedebos, Bruno I. Grisci, Marcio Dorn, and Hugo Verli. _Development of GROMOS-Compatible Parameter Set for Simulations of Chalcones and Flavonoids_, The Journal of Physical Chemistry B **2019** 123 (5), 994-1008, DOI: [10.1021/acs.jpcb.8b10139](https://doi.org/10.1021/acs.jpcb.8b10139)

- Roberta Tesch, Christian Becker, Matthias P. Müller, Michael E. Beck, Lena Quambusch, Matthäus Getlik, Jonas Lategahn, Niklas Uhlenbrock, Fanny N. Costa, Marcelo D. Polêto, Pedro S.M. Pinheiro, Daniel A. Rodrigues, Carlos M.R. Sant'Anna, Fabio F. Ferreira, Hugo Verli, Carlos A.M. Fraga, Daniel Rauh. _An Unusual Intramolecular Halogen Bond Guides Conformational Selection_, Angew. Chem. Int. Ed. **2018**, 57, 9970, DOI: [10.1002/anie.201804917](https://doi.org/10.1002/anie.201804917)

## How to cite ***ConfID***?

If you use ***ConfID***, please cite:

Marcelo D. Polêto, Bruno I. Grisci, Marcio Dorn, Hugo Verli. _ConfID: an analytical method for conformational characterization of small molecules using molecular dynamics trajectories_, Bioinformatics. **2019**, Volume X, Issue X, Pages XXXX-XXXX, doi (in submission)

Bibtex entry:
```
@article{confid,
  title={},
  author={},
  journal={},
  volume={},
  pages={},
  year={},
  publisher={}
}
```

***ConfID*** is registered at _Instituto Nacional da Propriedade Industrial (INPI)_ under the number BR512019001928-8 and is freely available under the license [LGPL-3.0](LICENSE.md).